name: Build Azure Policy Packages

on:
  workflow_dispatch:

jobs:
  package:
    name: Package
    uses: ./.github/workflows/package-build.yml
    strategy:
      matrix:
        target:
          [
            { os: ubuntu, version: 14.04, arch: amd64, dist: trusty, package-type: DEB, tag: "@sha256:1420b5ddf538bd058c77ef94ea65f6d8178ed18df613f39c6aba5f77067500ed" },
          ]
    secrets:
      onedstenant: >-
        ${{
          (github.ref == 'refs/heads/main' && secrets.ONEDS_TENANT_PROD) ||
          (github.ref == 'refs/heads/dev' && secrets.ONEDS_TENANT_NONPROD) ||
          ''
        }}
    with:
      target: ${{ matrix.target.os }}-${{ matrix.target.version }}
      arch: ${{ matrix.target.arch }}
      container-tag: ${{ matrix.target.tag }}
      artifact: policy-packages
      machine-config: true
      release: true
