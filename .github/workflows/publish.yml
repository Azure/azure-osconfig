name: Publish

on:
  workflow_call:
    inputs:
      target:
        type: string
        required: true
      arch:
        type: string
        required: true
      repo:
        type: string
        required: true
      dist:
        type: string
        required: true

jobs:
  package:
    uses: ./.github/workflows/package-build.yml
    with:
      target: ${{ inputs.target }}
      arch: ${{ inputs.arch }}
      artifact: ${{ inputs.target }}-${{ inputs.arch }}
      release: true

  sign:
    uses: ./.github/workflows/package-sign.yml
    needs: package
    with:
      artifact: ${{ inputs.target }}-${{ inputs.arch }}
    secrets: inherit

  publish:
    uses: ./.github/workflows/package-publish.yml
    needs: sign
    with:
      repo: ${{ inputs.repo }}
      dist: ${{ inputs.dist }}
      artifact: ${{ inputs.target }}-${{ inputs.arch }}-signed
    secrets: inherit
