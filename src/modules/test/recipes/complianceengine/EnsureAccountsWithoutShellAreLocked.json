[
  {
    "Action": "LoadModule",
    "Module": "complianceengine.so"
  },
  {
    "ObjectType": "Desired",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "procedureTest",
    "Payload": {
      "audit": {
        "EnsureAccountsWithoutShellAreLocked": {
        }
      }
    }
  },



  {
    "RunCommand": "[ -f /etc/shells ] && mv -v /etc/shells /etc/shells.bak"
  },
  {
    "RunCommand": "[ -f /etc/passwd ] && mv -v /etc/passwd /etc/passwd.bak"
  },
  {
    "RunCommand": "[ -f /etc/shadow ] && mv -v /etc/shadow /etc/shadow.bak"
  },

  {
    "RunCommand": "echo \"/bin/bash\" > /etc/shells"
  },
  {
    "RunCommand": "echo \"/bin/nologin\" >> /etc/shells"
  },
  {
    "RunCommand": "touch /etc/shadow"
  },
  {
    "RunCommand": "touch /etc/passwd"
  },

  // No users, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureAccountsWithoutShellAreLocked: All non-root users without a login shell are locked } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/bash' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser:!:20206::::::' > /etc/shadow"
  },

  // The user has a valid shell, PASS expected
  // The user will not be reported in the compliant indicators,
  // as it is skipped early due to the valid shell.
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureAccountsWithoutShellAreLocked: All non-root users without a login shell are locked } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/nologin' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser:!:20206::::::' > /etc/shadow"
  },

  // The user has an invalid shell, but is locked, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureAccountsWithoutShellAreLocked: User 9999 does not have a valid shell, but the account is locked, All non-root users without a login shell are locked } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/nologin' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser:*:20206::::::' > /etc/shadow"
  },

  // The user has an invalid shell, but is locked, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureAccountsWithoutShellAreLocked: User 9999 does not have a valid shell, but the account is locked, All non-root users without a login shell are locked } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/nologin' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser:!*:20206::::::' > /etc/shadow"
  },

  // The user has an invalid shell, but is locked, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureAccountsWithoutShellAreLocked: User 9999 does not have a valid shell, but the account is locked, All non-root users without a login shell are locked } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/nologin' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser:$y$:20206::::::' > /etc/shadow"
  },

  // The user has an invalid shell, but is not locked, failure expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "{ EnsureAccountsWithoutShellAreLocked: User 9999 does not have a valid shell, but the account is not locked } == FALSE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/bash' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser:$y$:20206::::::' > /etc/shadow"
  },
  {
    "RunCommand": "cat /etc/shells"
  },

  // The user has a valid shell and is not locked, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureAccountsWithoutShellAreLocked: All non-root users without a login shell are locked } == TRUE"
  },

  // Cleanup
  {
    "RunCommand":"[ -f /etc/shells.bak ] && mv -v /etc/shells.bak /etc/shells"
  },
  {
    "RunCommand":"[ -f /etc/shadow.bak ] && mv -v /etc/shadow.bak /etc/shadow"
  },
  {
    "RunCommand":"[ -f /etc/passwd.bak ] && mv -v /etc/passwd.bak /etc/passwd"
  },


  {
    "Action": "UnloadModule"
  }
]
