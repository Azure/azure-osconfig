[
  {
    "Action": "LoadModule",
    "Module": "complianceengine.so"
  },
  {
    "ObjectType": "Desired",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "procedureTest",
    "Payload": {
      "audit": {
        "EnsurePasswordChangeIsInPast": {
        }
      }
    }
  },



  // Make sure there are no residues of other module tests
  {
    "RunCommand": "! stat /home/securitybaselinetest"
  },

  // No securitybaselintetest user, we expect compliance
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsurePasswordChangeIsInPast: All users have password change dates in the past } == TRUE"
  },

  // Create the securitybaselinetest user and group
  {
    "RunCommand": "groupadd -g 8888 securitybaselinetest"
  },
  {
    "RunCommand": "useradd -g 8888 securitybaselinetest && id securitybaselinetest"
  },


  // Create a an entry with the last password change date in future
  {
    "RunCommand": "echo 'securitybaselinetest:$y$:99999:2:3:4:5:6:' >> /etc/shadow"
  },
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "{ EnsurePasswordChangeIsInPast: User securitybaselinetest has a password change date in the future, At least 1 users have password change dates in the future } == FALSE"
  },

  // cleanup
  {
    "RunCommand": "sed -i '$d' /etc/shadow"
  },
  {
    "RunCommand": "userdel -f -r securitybaselinetest || true"
  },
  {
    "RunCommand": "groupdel securitybaselinetest || true"
  },
  {
    "Action": "UnloadModule"
  }
]
