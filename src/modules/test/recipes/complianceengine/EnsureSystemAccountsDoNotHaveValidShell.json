[
  {
    "Action": "LoadModule",
    "Module": "complianceengine.so"
  },
  {
    "ObjectType": "Desired",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "procedureTest",
    "Payload": {
      "audit": {
        "EnsureSystemAccountsDoNotHaveValidShell": {
        }
      }
    }
  },



  {
    "RunCommand": "[ -f /etc/shells ] && mv -v /etc/shells /etc/shells.bak"
  },
  {
    "RunCommand": "[ -f /etc/passwd ] && mv -v /etc/passwd /etc/passwd.bak"
  },

  {
    "RunCommand": "echo \"/bin/bash\" > /etc/shells"
  },
  {
    "RunCommand": "echo \"/bin/nologin\" >> /etc/shells"
  },
  {
    "RunCommand": "touch /etc/passwd"
  },

  // No users, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureSystemAccountsDoNotHaveValidShell:  } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:9999:9999:::/bin/bash' > /etc/passwd"
  },
  {
    "RunCommand": "echo 'securitybaselinetestuser2:x:9999:9999:::/bin/nologin' >> /etc/passwd"
  },

  // Regular users - PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureSystemAccountsDoNotHaveValidShell:  } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:99:99:::/bin/nologin' > /etc/passwd"
  },

  // System user with nologin shell - pass expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "PASS{ EnsureSystemAccountsDoNotHaveValidShell: System user 99 does not have a valid login shell } == TRUE"
  },

  {
    "RunCommand": "echo 'securitybaselinetestuser:x:99:99:::/bin/bash' > /etc/passwd"
  },

  // The user has an invalid shell, but is locked, PASS expected
  {
    "ObjectType": "Reported",
    "ComponentName": "ComplianceEngine",
    "ObjectName": "auditTest",
    "Payload": "{ EnsureSystemAccountsDoNotHaveValidShell: System user 99 has a valid login shell } == FALSE"
  },


  // Cleanup
  {
    "RunCommand":"[ -f /etc/shells.bak ] && mv -v /etc/shells.bak /etc/shells"
  },
  {
    "RunCommand":"[ -f /etc/passwd.bak ] && mv -v /etc/passwd.bak /etc/passwd"
  },


  {
    "Action": "UnloadModule"
  }
]
