{
    "modules": [
        "deliveryoptimization"
    ],
    "setup": "[ -f /etc/deliveryoptimization-agent/admin-config.json ] && cp /etc/deliveryoptimization-agent/admin-config.json /tmp/admin-config.json.bak",
    "teardown": [
        "[ -f /tmp/admin-config.json.bak ] && cp /tmp/admin-config.json.bak /etc/deliveryoptimization-agent/admin-config.json",
        "rm -f /tmp/admin-config.json.bak"
    ],
    "steps": [
        {
            "type": "reported",
            "component": "DeliveryOptimization",
            "object": "cacheHost"
        },
        {
            "type": "reported",
            "component": "DeliveryOptimization",
            "object": "cacheHostSource"
        },
        {
            "type": "reported",
            "component": "DeliveryOptimization",
            "object": "cacheHostFallback"
        },
        {
            "type": "reported",
            "component": "DeliveryOptimization",
            "object": "percentageDownloadThrottle"
        },
        {
            "type": "reported",
            "component": "DeliveryOptimization",
            "object": "invalid",
            "expect": {
                "status": 22
            }
        },
        {
            "type": "desired",
            "component": "DeliveryOptimization",
            "object": "desiredDeliveryOptimizationPolicies",
            "payload": {
                "cacheHost": "10.0.0.0:80,host.com:8080",
                "cacheHostSource": 1,
                "cacheHostFallback": 2,
                "percentageDownloadThrottle": 3
            }
        },
        {
            "run": [
                "cat /etc/deliveryoptimization-agent/admin-config.json",
                "grep -q '\"DOCacheHost\": \"10.0.0.0:80,host.com:8080\"' /etc/deliveryoptimization-agent/admin-config.json",
                "grep -q '\"DOCacheHostSource\": 1' /etc/deliveryoptimization-agent/admin-config.json",
                "grep -q '\"DOCacheHostFallback\": 2' /etc/deliveryoptimization-agent/admin-config.json",
                "grep -q '\"DOPercentageDownloadThrottle\": 3' /etc/deliveryoptimization-agent/admin-config.json"
            ]
        },
        {
            "type": "desired",
            "component": "DeliveryOptimization",
            "object": "desiredDeliveryOptimizationPolicies",
            "payload": {
                "cacheHostSource": -1
            },
            "expect": {
                "status": 22
            }
        },
        {
            "type": "desired",
            "component": "DeliveryOptimization",
            "object": "desiredDeliveryOptimizationPolicies",
            "payload": {
                "percentageDownloadThrottle": -1
            },
            "expect": {
                "status": 22
            }
        }
    ]
}